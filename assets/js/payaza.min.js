jQuery( function( $ ) {

	let payaza_submit = false;

	$( '#wc-payaza-form' ).hide();

	wcPayazaFormHandler();

	jQuery( '#payaza-payment-button' ).click( function() {
		return wcPayazaFormHandler();
	} );

	jQuery( '#payaza_form form#order_review' ).submit( function() {
		return wcPayazaFormHandler();
	} );

	
	
	function wcPayazaFormHandler() {

		$( '#wc-payaza-form' ).hide();

		if ( payaza_submit ) {
			payaza_submit = false;
			return true;
		}

		let $form = $( 'form#payment-form, form#order_review' ),
			payaza_txnref = $form.find( 'input.payaza_txnref' );
		

		payaza_txnref.val( '' );

		
		let amount = Number( wc_payaza_params.amount );
		    

		let payaza_callback = function( response ) {
			$form.append( '<input type="hidden" class="payaza_txnref" name="payaza_txnref" value="' + response.trxref + '"/>' );
			payaza_submit = true;

			$form.submit();

			$( 'body' ).block( {
				message: null,
				overlayCSS: {
					background: '#fff',
					opacity: 0.6
				},
				css: {
					cursor: "wait"
				}
			} );
		};

				 payazaCheckout = PayazaCheckout.setup( {
				merchant_key: wc_payaza_params.key,
				
                connection_mode: "Live", // Live || Test
                checkout_amount: amount/100,
				currency_code: wc_payaza_params.currency,
                email_address: wc_payaza_params.email,
                first_name: wc_payaza_params.first_name,
                last_name: wc_payaza_params.last_name,
                phone_number:wc_payaza_params.phone_number,
                transaction_reference: wc_payaza_params.txnref,
				
		
			onClose: function() {
	
		       

			},
			
			
			
			callback: function (callbackResponse) {
				console.log('callback response', callbackResponse)
			}
		});

		function callback(callbackResponse) {
		console.log('callbackResponse: ', callbackResponse)
		}

		function onClose() {
			console.log("closed")
			//window.location.href = "WC()->api_request_url()";
		}
       
	
		//let handler = PayazaCheckout.setup( paymentData );
		payazaCheckout.setCallback(callback)
		payazaCheckout.setOnClose(onClose)

		
		//let handler = 
		let handler = payazaCheckout.showPopup();

		handler.openIframe();

		return false;

	}

} );